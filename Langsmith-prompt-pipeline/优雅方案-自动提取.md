# ä¼˜é›…æ–¹æ¡ˆï¼šè‡ªåŠ¨æå–ä¸­é—´ç»“æœ ğŸš€

## é—®é¢˜å›é¡¾

**åŸæ–¹æ¡ˆçš„é—®é¢˜**ï¼š
- âŒ éœ€è¦æ‰‹åŠ¨æ„å»ºä¸­é—´ç»“æœ
- âŒ æ¯ä¸ª LLM èŠ‚ç‚¹éƒ½è¦é€‚é…
- âŒ æ¯ä¸ªæ–° graph éƒ½è¦é‡æ–°é…ç½®

## æ–°æ–¹æ¡ˆï¼šé›¶ä¾µå…¥è‡ªåŠ¨æå– âœ¨

### æ ¸å¿ƒæ€è·¯

LangSmith å·²ç»è‡ªåŠ¨è®°å½•äº†æ‰€æœ‰è¿è¡Œçš„å®Œæ•´ Traceï¼ŒåŒ…æ‹¬ï¼š
- æ¯ä¸ª LLM è°ƒç”¨çš„è¾“å…¥
- æ¯ä¸ª LLM è°ƒç”¨çš„è¾“å‡º
- å®Œæ•´çš„æ‰§è¡Œé“¾è·¯

**æˆ‘ä»¬åªéœ€è¦ä» Trace ä¸­è‡ªåŠ¨æå–è¿™äº›æ•°æ®ï¼**

---

## ä½¿ç”¨æ–¹æ³•ï¼ˆ3æ­¥ï¼Œ2åˆ†é’Ÿï¼‰

### ç¬¬1æ­¥ï¼šè¿è¡Œä¸€æ¬¡ä½ çš„ Graphï¼ˆå·²æœ‰ï¼‰

```bash
# ä½ å·²ç»åœ¨åšçš„äº‹æƒ…
python main.py --query "äººå·¥æ™ºèƒ½è¡Œä¸šåˆ†æ"
```

è¿™ä¼šè‡ªåŠ¨è®°å½•åˆ° LangSmithï¼ˆå¦‚æœé…ç½®äº† `LANGSMITH_API_KEY`ï¼‰

### ç¬¬2æ­¥ï¼šè‡ªåŠ¨æå–ä¸­é—´ç»“æœ

```bash
python tools/auto_extract_from_trace.py
```

**äº¤äº’å¼ç•Œé¢**ï¼š
```
æ‰¾åˆ° 10 æ¡è¿è¡Œè®°å½•:

1. Run ID: abc123...
   åç§°: ReportGraph
   æ—¶é—´: 2024-10-25 14:30:00
   æŸ¥è¯¢: äººå·¥æ™ºèƒ½è¡Œä¸šåˆ†æ...
   çŠ¶æ€: success
------------------------------------------------------------

è¯·é€‰æ‹©æ“ä½œ:
1. ä¿å­˜æŸæ¬¡è¿è¡Œçš„ LLM è¾“å…¥
2. ä»å¤šæ¬¡è¿è¡Œåˆ›å»º LangSmith Dataset
3. é€€å‡º

é€‰æ‹© (1/2/3): 2

é€‰æ‹©è¿è¡Œç¼–å·ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œå¦‚ 1,2,3ï¼‰: 1,2,3

Dataset åç§°ï¼ˆç•™ç©ºä½¿ç”¨é»˜è®¤ï¼‰: my_test_inputs

åªæå–ç‰¹å®šèŠ‚ç‚¹ï¼Ÿï¼ˆç•™ç©º=å…¨éƒ¨ï¼Œå¦‚ 'report_generator'ï¼‰: 

[å¼€å§‹] åˆ›å»º Dataset: my_test_inputs
============================================================
å¤„ç† Run: abc123...
  [OK] æ‰¾åˆ° LLM è°ƒç”¨: parse_parameters_node
  [OK] æ‰¾åˆ° LLM è°ƒç”¨: generate_report_node
  [OK] æ·»åŠ ç¤ºä¾‹: parse_parameters_node
  [OK] æ·»åŠ ç¤ºä¾‹: generate_report_node

[å®Œæˆ] Dataset åˆ›å»ºå®Œæˆ!
  - æ•°æ®é›†åç§°: my_test_inputs
  - æ€»ç¤ºä¾‹æ•°: 6
  - æŸ¥çœ‹: https://smith.langchain.com/datasets

ä½¿ç”¨æ–¹æ³•:
  1. è®¿é—® LangSmith Playground
  2. é€‰æ‹©ä½ çš„æç¤ºè¯
  3. ç‚¹å‡» 'Select Dataset' â†’ 'my_test_inputs'
  4. åˆ‡æ¢æç¤ºè¯ï¼Œè¾“å…¥ä¼šè‡ªåŠ¨å¡«å…… âœ…
```

### ç¬¬3æ­¥ï¼šåœ¨ Playground ä¸­ä½¿ç”¨

1. è®¿é—® https://smith.langchain.com/
2. è¿›å…¥ **Prompts** â†’ é€‰æ‹© `report_generator`
3. ç‚¹å‡» **Open in Playground**
4. ç‚¹å‡» **Select Dataset** â†’ é€‰æ‹© `my_test_inputs`
5. ç°åœ¨å¯ä»¥ï¼š
   - âœ… åˆ‡æ¢ä¸åŒçš„æç¤ºè¯ç‰ˆæœ¬
   - âœ… åˆ‡æ¢ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹
   - âœ… **è¾“å…¥è‡ªåŠ¨å¡«å……ï¼Œä¸ä¼šä¸¢å¤±**

---

## ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | æ‰‹åŠ¨æ–¹æ¡ˆ | è‡ªåŠ¨æå–æ–¹æ¡ˆ |
|-----|---------|------------|
| æ„å»ºä¸­é—´ç»“æœ | âŒ æ‰‹åŠ¨ç¼–å†™ä»£ç  | âœ… è‡ªåŠ¨ä» Trace æå– |
| ä»£ç ä¾µå…¥æ€§ | âŒ éœ€è¦ä¿®æ”¹ nodes.py | âœ… é›¶ä¾µå…¥ |
| é€‚é…æ–° Graph | âŒ æ¯ä¸ªéƒ½è¦é€‚é… | âœ… é€šç”¨ï¼Œæ— éœ€é€‚é… |
| æå–æ‰€æœ‰èŠ‚ç‚¹ | âŒ æ‰‹åŠ¨æŒ‡å®š | âœ… è‡ªåŠ¨æå–å…¨éƒ¨ |
| æ›´æ–°åœºæ™¯ | âŒ æ‰‹åŠ¨ä¿®æ”¹ä»£ç  | âœ… é‡æ–°è¿è¡Œå³å¯ |

---

## å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘ï¼šè°ƒè¯•æç¤ºè¯

```bash
# 1. è¿è¡Œä¸€æ¬¡ï¼ˆæµ‹è¯•æ–°åŠŸèƒ½ï¼‰
python main.py --query "åŒºå—é“¾æŠ€æœ¯å‘å±•"

# 2. è‡ªåŠ¨æå–ä¸­é—´ç»“æœ
python tools/auto_extract_from_trace.py
# â†’ é€‰æ‹©é€‰é¡¹ 2
# â†’ é€‰æ‹©æœ€è¿‘çš„å‡ æ¬¡è¿è¡Œ
# â†’ åˆ›å»º Dataset

# 3. åœ¨ Playground ä¸­æµ‹è¯•ä¸åŒæç¤ºè¯
# â†’ è®¿é—® LangSmith Playground
# â†’ é€‰æ‹© Dataset
# â†’ åˆ‡æ¢æç¤ºè¯ç‰ˆæœ¬
# â†’ è¾“å…¥è‡ªåŠ¨å¡«å…… âœ…
```

### å›¢é˜Ÿåä½œï¼šå…±äº«æµ‹è¯•æ•°æ®

```bash
# å¼€å‘è€… Aï¼šè·‘å‡ ä¸ªå…¸å‹åœºæ™¯
python main.py --query "AI è¡Œä¸šæŠ¥å‘Š"
python main.py --query "é‡‘èç§‘æŠ€åˆ†æ"
python main.py --query "æ–°èƒ½æºæ±½è½¦ç ”ç©¶"

# åˆ›å»ºå…±äº« Dataset
python tools/auto_extract_from_trace.py
# â†’ é€‰æ‹©è¿™ 3 æ¬¡è¿è¡Œ
# â†’ Dataset åç§°: "team_test_cases"

# å¼€å‘è€… Bã€Cã€Dï¼šç›´æ¥ä½¿ç”¨
# â†’ åœ¨ Playground é€‰æ‹© "team_test_cases"
# â†’ ç«‹å³å¼€å§‹è°ƒè¯• âœ…
```

---

## é«˜çº§ç”¨æ³•

### 1. åªæå–ç‰¹å®šèŠ‚ç‚¹çš„è¾“å…¥

```bash
python tools/auto_extract_from_trace.py

# é€‰æ‹©é€‰é¡¹ 2
# åªæå–ç‰¹å®šèŠ‚ç‚¹ï¼šreport_generator

# ç»“æœï¼šDataset ä¸­åªåŒ…å« report_generator èŠ‚ç‚¹çš„è¾“å…¥
```

### 2. ç¼–ç¨‹å¼ä½¿ç”¨

```python
from tools.auto_extract_from_trace import TraceExtractor

extractor = TraceExtractor()

# æ–¹å¼1ï¼šäº¤äº’å¼
extractor.interactive_mode()

# æ–¹å¼2ï¼šç¼–ç¨‹å¼
runs = extractor.list_recent_runs(limit=5)
run_id = str(runs[0].id)

# ä¿å­˜ä¸­é—´ç»“æœ
data = extractor.save_llm_inputs(run_id, scenario_name="my_test")

# åˆ›å»º Dataset
extractor.create_dataset_from_runs(
    run_ids=[run_id],
    dataset_name="auto_test_inputs",
    llm_node_filter="report_generator"  # å¯é€‰ï¼šåªæå–ç‰¹å®šèŠ‚ç‚¹
)
```

### 3. CI/CD é›†æˆ

```yaml
# .github/workflows/create_test_dataset.yml
name: Create Test Dataset

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

jobs:
  create-dataset:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Run test scenarios
        env:
          AZURE_OPENAI_API_KEY: ${{ secrets.AZURE_OPENAI_API_KEY }}
          LANGSMITH_API_KEY: ${{ secrets.LANGSMITH_API_KEY }}
        run: |
          # è¿è¡Œå‡ ä¸ªå…¸å‹åœºæ™¯
          python main.py --query "AI è¡Œä¸šæŠ¥å‘Š"
          python main.py --query "é‡‘èç§‘æŠ€åˆ†æ"
          python main.py --query "æ–°èƒ½æºç ”ç©¶"
      
      - name: Extract and create dataset
        run: |
          python -c "
          from tools.auto_extract_from_trace import TraceExtractor
          extractor = TraceExtractor()
          runs = extractor.list_recent_runs(limit=3)
          run_ids = [str(r.id) for r in runs]
          extractor.create_dataset_from_runs(run_ids, 'ci_test_dataset')
          "
```

---

## ä¸æ–¹æ¡ˆ1å¯¹æ¯”

### æ–¹æ¡ˆ1ï¼ˆæ‰‹åŠ¨ï¼‰ï¼š`.middle_results_cache/`

**ä¼˜åŠ¿**ï¼š
- âœ… æœ¬åœ°æµ‹è¯•ï¼ˆæ— éœ€è”ç½‘ï¼‰
- âœ… å®Œå…¨æ§åˆ¶æ•°æ®æ ¼å¼

**åŠ£åŠ¿**ï¼š
- âŒ éœ€è¦æ‰‹åŠ¨ç¼–å†™ä¿å­˜ä»£ç 
- âŒ éœ€è¦é€‚é…æ¯ä¸ª Graph
- âŒ æ›´æ–°åœºæ™¯éœ€è¦ä¿®æ”¹ä»£ç 

### æ–¹æ¡ˆ2ï¼ˆè‡ªåŠ¨ï¼‰ï¼šä» Trace æå–

**ä¼˜åŠ¿**ï¼š
- âœ… é›¶ä»£ç ä¾µå…¥
- âœ… é€šç”¨ï¼Œé€‚ç”¨ä»»ä½• Graph
- âœ… è‡ªåŠ¨æå–æ‰€æœ‰èŠ‚ç‚¹
- âœ… æ›´æ–°åœºæ™¯åªéœ€é‡æ–°è¿è¡Œ

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦é…ç½® LANGSMITH_API_KEY
- âš ï¸ éœ€è¦è”ç½‘ï¼ˆä½† Playground æœ¬èº«å°±éœ€è¦ï¼‰

---

## æ¨èä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|-----|---------|------|
| **å¤šä¸ª Graph é¡¹ç›®** | æ–¹æ¡ˆ2ï¼ˆè‡ªåŠ¨æå–ï¼‰| é€šç”¨ï¼Œæ— éœ€æ¯ä¸ªéƒ½é€‚é… |
| **å›¢é˜Ÿåä½œ** | æ–¹æ¡ˆ2ï¼ˆè‡ªåŠ¨æå–ï¼‰| è‡ªåŠ¨å…±äº«åˆ° LangSmith |
| **å¿«é€ŸåŸå‹å¼€å‘** | æ–¹æ¡ˆ2ï¼ˆè‡ªåŠ¨æå–ï¼‰| é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨ |
| **ç¦»çº¿å¼€å‘** | æ–¹æ¡ˆ1ï¼ˆæ‰‹åŠ¨ï¼‰| ä¸éœ€è¦è”ç½‘ |
| **é«˜åº¦å®šåˆ¶åœºæ™¯** | æ–¹æ¡ˆ1ï¼ˆæ‰‹åŠ¨ï¼‰| å®Œå…¨æ§åˆ¶æ•°æ®æ ¼å¼ |

**å»ºè®®**ï¼šä¼˜å…ˆä½¿ç”¨æ–¹æ¡ˆ2ï¼Œç‰¹æ®Šæƒ…å†µç”¨æ–¹æ¡ˆ1

---

## å¸¸è§é—®é¢˜

### Q1: éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç å—ï¼Ÿ

**A**: ä¸éœ€è¦ï¼åªè¦ä½ çš„é¡¹ç›®é…ç½®äº† LangSmithï¼ˆè®¾ç½®äº† `LANGSMITH_API_KEY`ï¼‰ï¼Œå°±ä¼šè‡ªåŠ¨è®°å½• Traceï¼Œç„¶åè¿è¡Œæå–å·¥å…·å³å¯ã€‚

### Q2: é€‚ç”¨äºæ‰€æœ‰ LangGraph é¡¹ç›®å—ï¼Ÿ

**A**: æ˜¯çš„ï¼è¿™ä¸ªå·¥å…·ä¼šè‡ªåŠ¨æ£€æµ‹æ‰€æœ‰ LLM è°ƒç”¨ï¼ˆ`run_type` ä¸º `llm` æˆ– `chat_model`ï¼‰ï¼Œæ— è®ºä½ çš„ Graph ç»“æ„å¦‚ä½•ã€‚

### Q3: å¦‚ä½•æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯ï¼Ÿ

**A**: 
```bash
# 1. è¿è¡Œæ–°åœºæ™¯
python main.py --query "æ–°çš„æµ‹è¯•åœºæ™¯"

# 2. é‡æ–°æå–
python tools/auto_extract_from_trace.py
# â†’ é€‰æ‹©æœ€æ–°çš„è¿è¡Œè®°å½•
```

### Q4: èƒ½å¦åªæå–æŸä¸ªç‰¹å®šèŠ‚ç‚¹ï¼Ÿ

**A**: å¯ä»¥ï¼åœ¨åˆ›å»º Dataset æ—¶æŒ‡å®š `llm_node_filter`ï¼š
```python
extractor.create_dataset_from_runs(
    run_ids=[...],
    llm_node_filter="report_generator"  # åªæå–è¿™ä¸ªèŠ‚ç‚¹
)
```

### Q5: ä¸æ‰‹åŠ¨æ–¹æ¡ˆå¯ä»¥å…±å­˜å—ï¼Ÿ

**A**: å¯ä»¥ï¼ä¸¤ç§æ–¹æ¡ˆäº’ä¸å†²çªï¼š
- æ–¹æ¡ˆ1ï¼šæœ¬åœ°å¿«é€Ÿæµ‹è¯•
- æ–¹æ¡ˆ2ï¼šå›¢é˜Ÿå…±äº«ã€Playground ä½¿ç”¨

---

## æ€»ç»“

### æ ¸å¿ƒä»·å€¼

**ä» "æ‰‹åŠ¨é€‚é…æ¯ä¸ª Graph"**  
**åˆ° "é€šç”¨è‡ªåŠ¨æå–ï¼Œé›¶ä»£ç ä¾µå…¥"**

### ä½¿ç”¨æµç¨‹

```
è¿è¡Œ Graphï¼ˆå·²æœ‰ï¼‰
    â†“
è‡ªåŠ¨æå–ï¼ˆ2åˆ†é’Ÿï¼‰
    â†“
Playground ä½¿ç”¨ï¼ˆè¾“å…¥è‡ªåŠ¨å¡«å……ï¼‰âœ…
```

### ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œä¸€æ¬¡ä½ çš„ Graph
2. è¿è¡Œ `python tools/auto_extract_from_trace.py`
3. åœ¨ Playground ä¸­é€‰æ‹©åˆ›å»ºçš„ Dataset
4. å¼€å§‹è°ƒè¯•ï¼Œåˆ‡æ¢æç¤ºè¯ï¼Œè¾“å…¥è‡ªåŠ¨å¡«å…… ğŸ‰

---

## æ–‡ä»¶ä½ç½®

- **å·¥å…·è„šæœ¬**ï¼š`tools/auto_extract_from_trace.py`
- **ç¼“å­˜ç›®å½•**ï¼š`.trace_cache/`ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
- **ä½¿ç”¨æ–‡æ¡£**ï¼š`ä¼˜é›…æ–¹æ¡ˆ-è‡ªåŠ¨æå–.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰

å®Œæ•´æ–¹æ¡ˆå¯¹æ¯”è¯·æŸ¥çœ‹ï¼š`docs/å¤šLLMæµç¨‹è°ƒè¯•æ–¹æ¡ˆ.md`

