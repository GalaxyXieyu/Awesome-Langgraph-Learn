# Interactive Deep Research ğŸš€

ä¸€ä¸ªåŸºäºLangGraphçš„é«˜çº§äº¤äº’å¼æ·±åº¦ç ”ç©¶æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿï¼Œé›†æˆäº†Multi-Agentåä½œã€Human-in-loopäº¤äº’å’Œå®æ—¶æµå¼è¾“å‡ºã€‚ä¸“ä¸ºå‰ç«¯äº¤äº’å¼æŠ¥å‘Šç”Ÿæˆè®¾è®¡ï¼Œæ”¯æŒå¤šç§è¿è¡Œæ¨¡å¼å’Œæ™ºèƒ½åŒ–å·¥ä½œæµã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¤– Multi-Agentåä½œç³»ç»Ÿ
- **æ™ºèƒ½ç›‘ç£å™¨**: å…¨å±€ä»»åŠ¡åè°ƒå’Œæ™ºèƒ½è·¯ç”±
- **ç ”ç©¶ä¸“å®¶**: æ·±åº¦ä¿¡æ¯æ”¶é›†å’Œå¤šæºæ•°æ®æ•´åˆ  
- **åˆ†æä¸“å®¶**: è¶‹åŠ¿è¯†åˆ«å’Œæ´å¯Ÿç”Ÿæˆ
- **å†™ä½œä¸“å®¶**: ä¸“ä¸šå†…å®¹åˆ›ä½œå’ŒæŠ¥å‘Šç”Ÿæˆ
- **éªŒè¯ä¸“å®¶**: è´¨é‡æ§åˆ¶å’Œæ ‡å‡†éªŒè¯

### ğŸ”„ Human-in-loopäº¤äº’
- **äº¤äº’æ¨¡å¼ (Interactive)**: æ¯ä¸ªå…³é”®æ­¥éª¤éœ€è¦ç”¨æˆ·ç¡®è®¤
- **å‰¯é©¾é©¶æ¨¡å¼ (Copilot)**: è‡ªåŠ¨é€šè¿‡æ‰€æœ‰ç¡®è®¤ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–
- **å¼•å¯¼æ¨¡å¼ (Guided)**: æä¾›å»ºè®®ä½†éœ€è¦ç”¨æˆ·æœ€ç»ˆå†³ç­–
- **æ™ºèƒ½ä¸­æ–­**: æ”¯æŒå·¥ä½œæµä¸­æ–­å’Œæ¢å¤

### ğŸ“¡ å®æ—¶æµå¼è¾“å‡º
- **å¤šæ¨¡å¼æµå¼**: æ”¯æŒcustomã€updatesã€messagesç­‰æ¨¡å¼
- **è¿›åº¦è¿½è¸ª**: å®æ—¶æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦å’ŒçŠ¶æ€
- **å†…å®¹å±•ç¤º**: å®æ—¶è¾“å‡ºå¤§çº²ç»“æ„å’Œå®Œæ•´æŠ¥å‘Šå†…å®¹
- **æ‰“å­—æœºæ•ˆæœ**: Tokençº§åˆ«çš„å®æ—¶å†…å®¹å±•ç¤º
- **å‰ç«¯å‹å¥½**: ä¸“ä¸ºWebç•Œé¢ä¼˜åŒ–çš„æ•°æ®æ ¼å¼
- **å®Œæ•´å†…å®¹æµ**: å¤§çº²ç”Ÿæˆæ—¶å³å¯çœ‹åˆ°å®Œæ•´ç»“æ„ï¼ŒæŠ¥å‘Šå®Œæˆæ—¶å³å¯çœ‹åˆ°å…¨æ–‡

### ğŸ§  æ™ºèƒ½åŒ–å·¥ä½œæµ
- **è‡ªé€‚åº”è§„åˆ’**: æ ¹æ®ä¸»é¢˜å’Œéœ€æ±‚æ™ºèƒ½åˆ¶å®šæ‰§è¡Œè®¡åˆ’
- **åŠ¨æ€è·¯ç”±**: åŸºäºæ‰§è¡ŒçŠ¶æ€æ™ºèƒ½é€‰æ‹©ä¸‹ä¸€æ­¥è¡ŒåŠ¨
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œè‡ªåŠ¨é‡è¯•æœºåˆ¶
- **çŠ¶æ€æŒä¹…åŒ–**: æ”¯æŒå·¥ä½œæµä¸­æ–­å’Œæ¢å¤

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
Interactive-Deep-Research/
â”œâ”€â”€ state.py          # çŠ¶æ€ç®¡ç†æ¨¡å—
â”œâ”€â”€ tools.py          # å·¥å…·é›†åˆæ¨¡å—  
â”œâ”€â”€ graph.py          # æ ¸å¿ƒå·¥ä½œæµå›¾
â”œâ”€â”€ test.py           # æµ‹è¯•å’Œæ¼”ç¤ºè„šæœ¬
â””â”€â”€ README.md         # é¡¹ç›®æ–‡æ¡£
```

### ğŸ“Š çŠ¶æ€ç®¡ç† (state.py)
```python
class DeepResearchState(TypedDict):
    # åŸºç¡€é…ç½®
    topic: str                    # ç ”ç©¶ä¸»é¢˜
    mode: ReportMode             # è¿è¡Œæ¨¡å¼
    user_id: str                 # ç”¨æˆ·ID
    
    # æŠ¥å‘Šé…ç½®  
    report_type: str             # æŠ¥å‘Šç±»å‹
    target_audience: str         # ç›®æ ‡è¯»è€…
    depth_level: str             # æ·±åº¦çº§åˆ«
    
    # æ ¸å¿ƒå†…å®¹
    outline: Optional[Dict]      # æŠ¥å‘Šå¤§çº²
    research_results: List[Dict] # ç ”ç©¶ç»“æœ
    analysis_insights: List[Dict] # åˆ†ææ´å¯Ÿ
    final_report: Optional[str]  # æœ€ç»ˆæŠ¥å‘Š
    
    # äº¤äº’çŠ¶æ€
    user_feedback: Dict[str, Any]     # ç”¨æˆ·åé¦ˆ
    approval_status: Dict[str, bool]  # å®¡æ‰¹çŠ¶æ€
    
    # ç³»ç»ŸçŠ¶æ€
    performance_metrics: Dict[str, Any] # æ€§èƒ½æŒ‡æ ‡
    messages: List[BaseMessage]         # æ¶ˆæ¯å†å²
```

### ğŸ› ï¸ å·¥å…·ç³»ç»Ÿ (tools.py)
- **æœç´¢å·¥å…·**: `advanced_web_search`, `multi_source_research`
- **åˆ†æå·¥å…·**: `content_analyzer`, `trend_analyzer`  
- **å†™ä½œå·¥å…·**: `section_content_generator`, `report_formatter`
- **éªŒè¯å·¥å…·**: `quality_validator`

### ğŸŒŠ å·¥ä½œæµå›¾ (graph.py)
```python
# æ ¸å¿ƒèŠ‚ç‚¹
intelligent_supervisor_node    # æ™ºèƒ½ç›‘ç£åè°ƒ
outline_generation_node       # å¤§çº²ç”Ÿæˆ
multi_agent_research_node     # Multi-Agentç ”ç©¶
analysis_generation_node      # åˆ†ææ´å¯Ÿç”Ÿæˆ
interaction_nodes            # äº¤äº’ç¡®è®¤èŠ‚ç‚¹

# å·¥ä½œæµç¨‹
START â†’ æ™ºèƒ½ç›‘ç£ â†’ å¤§çº²ç”Ÿæˆ â†’ ç”¨æˆ·ç¡®è®¤ â†’ æ·±åº¦ç ”ç©¶ â†’ åˆ†æç”Ÿæˆ â†’ å†…å®¹åˆ›å»º â†’ END
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ 

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- LangGraph >= 0.1.0
- LangChain >= 0.1.0  
- OpenAI APIæˆ–å…¼å®¹API
- Tavily API Key (å¯é€‰)

### å®‰è£…ä¾èµ–
```bash
pip install langgraph langchain langchain-openai langchain-community
```

### âš¡ ç«‹å³ä½“éªŒæµå¼è¾“å‡º

æœ€å¿«çš„ä½“éªŒæ–¹å¼æ˜¯è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python test.py
```

ç„¶åé€‰æ‹© `3` (äº¤äº’æ¼”ç¤ºæ¨¡æ‹Ÿ) æˆ– `4` (å®Œæ•´å†…å®¹å±•ç¤º)ï¼Œä½ å°†ç«‹å³çœ‹åˆ°ï¼š
- ğŸ”„ å®æ—¶çš„ç”Ÿæˆè¿›åº¦
- ğŸ“‹ å®Œæ•´çš„å¤§çº²ç»“æ„æµå¼è¾“å‡º
- ğŸ“„ å®Œæ•´çš„æŠ¥å‘Šå†…å®¹æµå¼è¾“å‡º
- â±ï¸ è¯¦ç»†çš„æ€§èƒ½ç»Ÿè®¡

### ğŸ¯ ä¸€åˆ†é’Ÿå¿«é€Ÿæµ‹è¯•

```bash
python test.py
# é€‰æ‹© 5 (å¿«é€ŸåŠŸèƒ½éªŒè¯)
# å°†åœ¨1-2åˆ†é’Ÿå†…çœ‹åˆ°å®Œæ•´çš„æµå¼è¾“å‡ºæ¼”ç¤º
```

### åŸºæœ¬ä½¿ç”¨

#### 1. ç®€å•æŠ¥å‘Šç”Ÿæˆ
```python
import asyncio
from graph import run_deep_research_report
from state import ReportMode

async def generate_report():
    result = await run_deep_research_report(
        topic="äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨å‰æ™¯",
        user_id="user_001",
        mode=ReportMode.COPILOT,  # è‡ªåŠ¨æ¨¡å¼
        report_type="research",
        target_audience="åŒ»ç–—ä¸“ä¸šäººå£«",
        depth_level="deep",
        target_length=3000
    )
    
    if result["success"]:
        print(f"âœ… æŠ¥å‘Šç”ŸæˆæˆåŠŸ: {result['session_id']}")
        print(f"ğŸ“Š ç ”ç©¶æ•°æ®: {result['quality_summary']['research_data_count']}æ¡")
        print(f"ğŸ’¡ åˆ†ææ´å¯Ÿ: {result['quality_summary']['analysis_insights_count']}ä¸ª")
    else:
        print(f"âŒ ç”Ÿæˆå¤±è´¥: {result['error']}")

# è¿è¡Œ
asyncio.run(generate_report())
```

#### 2. æµå¼è¾“å‡ºä½¿ç”¨ - å®æ—¶æŸ¥çœ‹å¤§çº²å’ŒæŠ¥å‘Š
```python
import asyncio
from graph import stream_deep_research_report
from state import ReportMode

async def stream_example():
    outline_received = False
    report_received = False
    
    async for chunk in stream_deep_research_report(
        topic="åŒºå—é“¾æŠ€æœ¯å‘å±•è¶‹åŠ¿",
        user_id="user_002", 
        mode=ReportMode.COPILOT  # è‡ªåŠ¨æ¨¡å¼ï¼Œå®Œæ•´å±•ç¤ºå†…å®¹
    ):
        chunk_type = chunk.get("type")
        
        if chunk_type == "stream_chunk":
            # å¤„ç†æµå¼æ•°æ®å—
            data = chunk.get("data", {})
            if isinstance(data, tuple) and len(data) == 2:
                mode, content = data
                if mode == "custom":
                    step = content.get("step", "")
                    status = content.get("status", "")
                    progress = content.get("progress", 0)
                    print(f"[{progress:3d}%] {step}: {status}")
                    
                    # ========== å®æ—¶å†…å®¹å±•ç¤º ==========
                    content_data = content.get("content")
                    if content_data and progress == 100:
                        content_type = content_data.get("type")
                        
                        # æ˜¾ç¤ºå®Œæ•´å¤§çº²
                        if content_type == "outline" and not outline_received:
                            outline_received = True
                            print("\\n" + "="*50)
                            print("ğŸ“‹ å®æ—¶å¤§çº²å±•ç¤º:")
                            print("="*50)
                            
                            display_text = content_data.get("display_text", "")
                            if display_text:
                                print(display_text)
                            
                            print("="*50)
                        
                        # æ˜¾ç¤ºå®Œæ•´æŠ¥å‘Š
                        elif content_type == "final_report" and not report_received:
                            report_received = True
                            print("\\n" + "="*50)
                            print("ğŸ“„ å®Œæ•´æŠ¥å‘Šå†…å®¹:")
                            print("="*50)
                            
                            full_report = content_data.get("full_report", "")
                            if full_report:
                                print(full_report)
                            
                            print("="*50)
                    
        elif chunk_type == "stream_complete":
            print("\\nâœ… æµå¼ç”Ÿæˆå®Œæˆ")
            print(f"ğŸ“‹ å¤§çº²å±•ç¤º: {'âœ…' if outline_received else 'âŒ'}")
            print(f"ğŸ“„ æŠ¥å‘Šå±•ç¤º: {'âœ…' if report_received else 'âŒ'}")
            break
            
        elif chunk_type == "stream_error":
            print(f"âŒ ç”Ÿæˆé”™è¯¯: {chunk.get('error')}")
            break

# è¿è¡Œæµå¼ç¤ºä¾‹
asyncio.run(stream_example())
```

#### 3. äº¤äº’æ¨¡å¼å¤„ç†
```python
from langgraph.types import interrupt

# åœ¨äº¤äº’æ¨¡å¼ä¸­ï¼Œç³»ç»Ÿä¼šåœ¨å…³é”®ç‚¹æš‚åœç­‰å¾…ç”¨æˆ·è¾“å…¥
# ç”¨æˆ·éœ€è¦å¤„ç†interruptæ¶ˆæ¯å¹¶æä¾›å“åº”

def handle_user_interaction(interrupt_data):
    """å¤„ç†ç”¨æˆ·äº¤äº’"""
    interaction_type = interrupt_data.get("type")
    message = interrupt_data.get("message")
    options = interrupt_data.get("options", [])
    
    print(f"ğŸ¤ {message}")
    print(f"é€‰é¡¹: {', '.join(options)}")
    
    # è¿”å›ç”¨æˆ·é€‰æ‹©
    return {"approved": True, "choice": options[0]}
```

## ğŸ“‹ è¿è¡Œæ¨¡å¼

### ğŸ¤– Copilotæ¨¡å¼ (è‡ªåŠ¨æ¨¡å¼)
```python
mode=ReportMode.COPILOT
```
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–æ‰§è¡Œ
- âœ… æ— éœ€ç”¨æˆ·å¹²é¢„  
- âœ… æœ€å¿«çš„æ‰§è¡Œé€Ÿåº¦
- âœ… é€‚åˆæ‰¹é‡å¤„ç†

### ğŸ¤ Interactiveæ¨¡å¼ (äº¤äº’æ¨¡å¼)
```python
mode=ReportMode.INTERACTIVE
```
- ğŸ›‘ å…³é”®æ­¥éª¤éœ€è¦ç”¨æˆ·ç¡®è®¤
- ğŸ¯ ç”¨æˆ·å¯ä»¥è°ƒæ•´æ–¹å‘
- ğŸ“ æ”¯æŒå®æ—¶åé¦ˆ
- ğŸ¨ æœ€é«˜çš„å®šåˆ¶åŒ–ç¨‹åº¦

### ğŸ§­ Guidedæ¨¡å¼ (å¼•å¯¼æ¨¡å¼)
```python
mode=ReportMode.GUIDED
```
- ğŸ’¡ ç³»ç»Ÿæä¾›å»ºè®®
- ğŸ¤” ç”¨æˆ·åšæœ€ç»ˆå†³ç­–
- âš–ï¸ å¹³è¡¡è‡ªåŠ¨åŒ–å’Œæ§åˆ¶
- ğŸ“ é€‚åˆå­¦ä¹ å’Œæ¢ç´¢

## ğŸ› ï¸ é«˜çº§é…ç½®

### æŠ¥å‘Šç±»å‹é…ç½®
```python
# ç ”ç©¶æŠ¥å‘Š - é‡ç‚¹æ˜¯ä¿¡æ¯æ”¶é›†å’Œç»¼åˆåˆ†æ
report_type="research"

# åˆ†ææŠ¥å‘Š - é‡ç‚¹æ˜¯è¶‹åŠ¿åˆ†æå’Œæ´å¯Ÿ
report_type="analysis"  

# å¸‚åœºæŠ¥å‘Š - é‡ç‚¹æ˜¯å¸‚åœºæ•°æ®å’Œé¢„æµ‹
report_type="market"

# æŠ€æœ¯æŠ¥å‘Š - é‡ç‚¹æ˜¯æŠ€æœ¯æ·±åº¦å’Œå®ç°
report_type="technical"
```

### æ·±åº¦çº§åˆ«é…ç½®
```python
# æµ…å±‚ç ”ç©¶ - å¿«é€Ÿæ¦‚è§ˆ
depth_level="shallow"

# ä¸­ç­‰æ·±åº¦ - å¹³è¡¡æ·±åº¦å’Œé€Ÿåº¦  
depth_level="medium"

# æ·±åº¦ç ”ç©¶ - å…¨é¢æ·±å…¥åˆ†æ
depth_level="deep"
```

### è‡ªå®šä¹‰å·¥å…·é…ç½®
```python
from tools import get_all_tools, advanced_web_search

# è·å–æ‰€æœ‰å¯ç”¨å·¥å…·
tools = get_all_tools()

# è‡ªå®šä¹‰æœç´¢å‚æ•°
search_result = advanced_web_search.invoke({
    "query": "æ·±åº¦å­¦ä¹ æœ€æ–°è¿›å±•",
    "max_results": 10,
    "search_depth": "advanced"
})
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å¹¶å‘å¤„ç†
```python
# ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œå¹¶å‘ç ”ç©¶
# å¤šä¸ªç« èŠ‚çš„ç ”ç©¶ä¼šå¹¶è¡Œæ‰§è¡Œ
# åˆ†æå’Œæ´å¯Ÿç”Ÿæˆä¼šå¤ç”¨æ•°æ®
```

### ç¼“å­˜æœºåˆ¶
```python
# ç ”ç©¶ç»“æœè‡ªåŠ¨ç¼“å­˜
# ç›¸ä¼¼æŸ¥è¯¢ä¼šå¤ç”¨ç»“æœ
# å‡å°‘é‡å¤çš„APIè°ƒç”¨
```

### æµå¼ä¼˜åŒ–
```python
# Tokençº§åˆ«çš„å®æ—¶è¾“å‡º
# æ¸è¿›å¼ç»“æœå±•ç¤º
# æœ€å°åŒ–å»¶è¿Ÿæ„ŸçŸ¥
```

## ğŸ§ª æµ‹è¯•å’Œæ¼”ç¤º

### è¿è¡Œç»¼åˆæµ‹è¯• - å…¨æµå¼è¾“å‡ºå±•ç¤º
```bash
python test.py
```

é€‰æ‹©æµ‹è¯•æ¨¡å¼:
1. **ğŸ“‹ ç»¼åˆæµ‹è¯•å¥—ä»¶** - å®Œæ•´åŠŸèƒ½éªŒè¯ï¼ŒåŒ…å«æµå¼å†…å®¹å±•ç¤º
2. **âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯•** - å®æ—¶æ€§èƒ½ç›‘æ§å’Œé˜¶æ®µè®¡æ—¶
3. **ğŸ­ äº¤äº’æ¼”ç¤ºæ¨¡æ‹Ÿ** - å®Œæ•´å¤§çº²å’ŒæŠ¥å‘Šå†…å®¹çš„æµå¼å±•ç¤º
4. **ğŸ“„ å®Œæ•´å†…å®¹å±•ç¤º** - è¯¦ç»†çš„å¤§çº²ç»“æ„å’Œå®Œæ•´æŠ¥å‘Šæ–‡æœ¬
5. **âš¡ å¿«é€ŸåŠŸèƒ½éªŒè¯** - æµå¼è¾“å‡ºçš„å¿«é€Ÿæµ‹è¯•
6. **ğŸ”§ ä»…ç¯å¢ƒæ£€æŸ¥** - å·¥å…·å’ŒAPIçŠ¶æ€éªŒè¯

### ğŸŒŠ æµå¼è¾“å‡ºç‰¹æ€§å±•ç¤º

æ‰€æœ‰æµ‹è¯•æ¨¡å¼éƒ½å·²å‡çº§ä¸º**æµå¼è¾“å‡º**ï¼Œä½ å°†èƒ½å¤Ÿï¼š

#### ğŸ“‹ å®æ—¶æŸ¥çœ‹å¤§çº²ç”Ÿæˆ
```
============================================================
ğŸ“‹ ç”Ÿæˆçš„æŠ¥å‘Šå¤§çº² (å®æ—¶æµå¼è¾“å‡º)
============================================================
ğŸ¯ æŠ¥å‘Šæ ‡é¢˜ï¼šPythonæœºå™¨å­¦ä¹ å…¥é—¨
ğŸ“ æ‰§è¡Œæ‘˜è¦ï¼šæœ¬æŠ¥å‘Šæ—¨åœ¨ä¸ºç¼–ç¨‹åˆå­¦è€…æä¾›ä¸€ä¸ªå…¨é¢çš„Pythonæœºå™¨å­¦ä¹ å…¥é—¨æŒ‡å—...
ğŸ“š ç ”ç©¶ç« èŠ‚ï¼š
  1. å¼•è¨€
     ä»‹ç»æŠ¥å‘Šçš„ç›®çš„ã€èƒŒæ™¯å’Œé‡è¦æ€§ã€‚
  2. PythonåŸºç¡€
     ä»‹ç»Pythonç¼–ç¨‹è¯­è¨€çš„åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•...
============================================================
```

#### ğŸ“„ å®æ—¶æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š
```
============================================================
ğŸ“„ æœ€ç»ˆæŠ¥å‘Šå†…å®¹ (å®æ—¶æµå¼è¾“å‡º)
============================================================
# Pythonæœºå™¨å­¦ä¹ å…¥é—¨

## å¼•è¨€
æœºå™¨å­¦ä¹ ä½œä¸ºäººå·¥æ™ºèƒ½çš„æ ¸å¿ƒåˆ†æ”¯ï¼Œæ­£åœ¨å„ä¸ªé¢†åŸŸäº§ç”Ÿæ·±è¿œå½±å“...

## PythonåŸºç¡€
Pythonä½œä¸ºä¸€é—¨ç®€æ´è€Œå¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€ï¼Œå·²æˆä¸ºæœºå™¨å­¦ä¹ é¢†åŸŸçš„é¦–é€‰å·¥å…·...
============================================================
```

#### âš¡ å®æ—¶æ€§èƒ½ç›‘æ§
```
ğŸ“Š åŸºå‡†æµ‹è¯• 1: å¿«é€ŸAIåº”ç”¨æµ‹è¯•
  ğŸ”„ å¤§çº²ç”Ÿæˆå®Œæˆ: 45.2s
  ğŸ” ç ”ç©¶å®Œæˆ: 120.5s  
  ğŸ“ å†…å®¹ç”Ÿæˆå®Œæˆ: 150.8s
  âœ… æ€»æ‰§è¡Œæ—¶é—´: 150.8s (é¢„æœŸ: 120s)
  ğŸ“ˆ æ€§èƒ½æ¯”ç‡: 1.26
  ğŸ“Š æ•°æ®å—å¤„ç†: 186ä¸ª
```

### æµ‹è¯•ç”¨ä¾‹
```python
# ç³»ç»ŸåŒ…å«ä¼˜åŒ–çš„æµå¼æµ‹è¯•ç”¨ä¾‹
STREAMING_TEST_CASES = [
    {
        "name": "AIæŠ€æœ¯åº”ç”¨",
        "topic": "äººå·¥æ™ºèƒ½åœ¨æ™ºæ…§åŒ»ç–—ä¸­çš„åº”ç”¨å‰æ™¯",
        "mode": ReportMode.COPILOT,
        "target_length": 1200,
        "depth_level": "medium",
        "expected_duration": 180
    },
    {
        "name": "æ•™è‚²æŠ€æœ¯å‘å±•", 
        "topic": "åœ¨çº¿æ•™è‚²å¹³å°çš„ç”¨æˆ·ä½“éªŒè®¾è®¡",
        "mode": ReportMode.INTERACTIVE,
        "target_length": 1000,
        "depth_level": "medium", 
        "expected_duration": 150
    }
]
```

## ğŸ¯ åº”ç”¨åœºæ™¯

### ğŸ“Š å•†ä¸šåˆ†æ
- å¸‚åœºç ”ç©¶æŠ¥å‘Š
- ç«äº‰å¯¹æ‰‹åˆ†æ  
- è¡Œä¸šè¶‹åŠ¿åˆ†æ
- æŠ•èµ„å†³ç­–æ”¯æŒ

### ğŸ”¬ å­¦æœ¯ç ”ç©¶
- æ–‡çŒ®ç»¼è¿°ç”Ÿæˆ
- ç ”ç©¶ç°çŠ¶åˆ†æ
- æŠ€æœ¯å‘å±•æŠ¥å‘Š
- å­¦ç§‘å‰æ²¿è°ƒç ”

### ğŸ’¼ ä¼ä¸šåº”ç”¨
- äº§å“è°ƒç ”æŠ¥å‘Š
- æŠ€æœ¯é€‰å‹åˆ†æ
- ä¸šåŠ¡å‘å±•è§„åˆ’
- é£é™©è¯„ä¼°æŠ¥å‘Š

### ğŸ“ æ•™è‚²åŸ¹è®­
- æ•™å­¦ææ–™å‡†å¤‡
- è¯¾ç¨‹å†…å®¹è®¾è®¡
- çŸ¥è¯†ç‚¹æ€»ç»“
- æ¡ˆä¾‹ç ”ç©¶åˆ†æ

## ğŸ”§ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„Agent
```python
from langgraph.prebuilt import create_react_agent
from tools import get_custom_tools

# åˆ›å»ºä¸“ä¸šåŒ–Agent
custom_agent = create_react_agent(
    llm=create_llm(),
    tools=get_custom_tools(),
    prompt="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„...ä¸“å®¶"
)

# æ·»åŠ åˆ°Agentæ³¨å†Œè¡¨
agents[AgentType.CUSTOM] = custom_agent
```

### è‡ªå®šä¹‰å·¥å…·å¼€å‘
```python
from langchain_core.tools import tool
from typing import Dict, Any

@tool
def custom_analysis_tool(data: str, analysis_type: str) -> Dict[str, Any]:
    """è‡ªå®šä¹‰åˆ†æå·¥å…·"""
    # å®ç°åˆ†æé€»è¾‘
    return {"result": "åˆ†æç»“æœ"}

# å°†å·¥å…·æ·»åŠ åˆ°å·¥å…·é›†
custom_tools = [custom_analysis_tool]
```

### æ–°äº¤äº’ç±»å‹
```python
from state import InteractionType

# å®šä¹‰æ–°çš„äº¤äº’ç±»å‹
class CustomInteractionType(str, Enum):
    CUSTOM_APPROVAL = "custom_approval"

# åˆ›å»ºå¯¹åº”çš„äº¤äº’èŠ‚ç‚¹
custom_interaction_node = create_interaction_node(
    CustomInteractionType.CUSTOM_APPROVAL
)
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ—¥å¿—é…ç½®
```python
import logging

# è®¾ç½®è¯¦ç»†æ—¥å¿—
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

# è·Ÿè¸ªæ‰§è¡Œè¿‡ç¨‹
logger.info("å¼€å§‹æŠ¥å‘Šç”Ÿæˆ...")
```

### æ€§èƒ½ç›‘æ§
```python
# ç³»ç»Ÿè‡ªåŠ¨æ”¶é›†æ€§èƒ½æŒ‡æ ‡
performance_metrics = {
    "start_time": 1234567890,
    "agent_execution_times": {
        "researcher": 45.2,
        "analyst": 23.1,
        "writer": 67.8
    },
    "interaction_count": 3,
    "research_queries_count": 15,
    "total_words_generated": 3247
}
```

### é”™è¯¯å¤„ç†
```python
# å®Œå–„çš„é”™è¯¯æ¢å¤æœºåˆ¶
try:
    result = await run_deep_research_report(...)
except Exception as e:
    logger.error(f"ç”Ÿæˆå¤±è´¥: {e}")
    # ç³»ç»Ÿä¼šè‡ªåŠ¨é‡è¯•æˆ–æä¾›æ›¿ä»£æ–¹æ¡ˆ
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

### è´¡çŒ®ç±»å‹
- ğŸ› Bugä¿®å¤
- âœ¨ æ–°åŠŸèƒ½å¼€å‘
- ğŸ“š æ–‡æ¡£æ”¹è¿›
- ğŸ§ª æµ‹è¯•ç”¨ä¾‹å¢åŠ 
- ğŸ¨ UI/UXæ”¹è¿›

### å¼€å‘æµç¨‹
1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®çš„æ”¯æŒï¼š
- [LangChain](https://github.com/langchain-ai/langchain) - å¼ºå¤§çš„LLMåº”ç”¨æ¡†æ¶
- [LangGraph](https://github.com/langchain-ai/langgraph) - çŠ¶æ€å›¾å·¥ä½œæµå¼•æ“
- [Tavily](https://tavily.com/) - é«˜è´¨é‡æœç´¢API
- [OpenAI](https://openai.com/) - å…ˆè¿›çš„è¯­è¨€æ¨¡å‹

## ğŸ“ è”ç³»æˆ‘ä»¬

- ğŸ› é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/your-repo/issues)
- ğŸ’¬ è®¨è®ºäº¤æµ: [GitHub Discussions](https://github.com/your-repo/discussions)
- ğŸ“§ é‚®ä»¶è”ç³»: your-email@example.com

---

<div align="center">

**ğŸš€ Interactive Deep Research - è®©AIç ”ç©¶æ›´æ™ºèƒ½ã€æ›´äº¤äº’ã€æ›´é«˜æ•ˆï¼**

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStarï¼

</div>

# äº¤äº’æ‰“æ–­åŠŸèƒ½ç³»ç»Ÿåˆ†æ

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

Interactive Deep Research ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„ Human-in-loop äº¤äº’æ‰“æ–­æœºåˆ¶ï¼Œæ”¯æŒç”¨æˆ·åœ¨æŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹ä¸­çš„å…³é”®èŠ‚ç‚¹è¿›è¡Œå¹²é¢„å’Œæ§åˆ¶ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### 1. æ ¸å¿ƒç»„ä»¶

```
äº¤äº’ç³»ç»Ÿæ¶æ„:
â”œâ”€â”€ InteractionType æšä¸¾     # å®šä¹‰5ç§äº¤äº’ç±»å‹
â”œâ”€â”€ ReportMode æšä¸¾          # å®šä¹‰3ç§è¿è¡Œæ¨¡å¼  
â”œâ”€â”€ create_interaction_node  # äº¤äº’èŠ‚ç‚¹å·¥å‚å‡½æ•°
â”œâ”€â”€ get_interaction_config   # äº¤äº’é…ç½®ç®¡ç†
â””â”€â”€ format_interaction_message # æ¶ˆæ¯æ ¼å¼åŒ–å™¨
```

### 2. äº¤äº’ç±»å‹å®šä¹‰

| äº¤äº’ç±»å‹ | è§¦å‘æ—¶æœº | ç”¨é€” | é…ç½®é€‰é¡¹ |
|---------|---------|------|----------|
| `OUTLINE_CONFIRMATION` | å¤§çº²ç”Ÿæˆå | ç¡®è®¤ç ”ç©¶å¤§çº²æ˜¯å¦ç¬¦åˆéœ€æ±‚ | ç¡®è®¤ç»§ç»­/ä¿®æ”¹å¤§çº²/é‡æ–°ç”Ÿæˆ |
| `RESEARCH_PERMISSION` | å¼€å§‹ç ”ç©¶å‰ | æˆæƒè¿›è¡Œç½‘ç»œæœç´¢å’Œæ•°æ®æ”¶é›† | å…è®¸ç ”ç©¶/è·³è¿‡ç ”ç©¶/é™åˆ¶èŒƒå›´ |
| `ANALYSIS_APPROVAL` | åˆ†æå®Œæˆå | å®¡æ‰¹åˆ†æç»“æœå’Œæ´å¯Ÿè´¨é‡ | ç¡®è®¤åˆ†æ/é‡æ–°åˆ†æ/è°ƒæ•´æ–¹å‘ |
| `CONTENT_REVIEW` | å†…å®¹ç”Ÿæˆå | å®¡æŸ¥æŠ¥å‘Šå†…å®¹è´¨é‡å’Œå‡†ç¡®æ€§ | é€šè¿‡å®¡æŸ¥/ä¿®æ”¹å†…å®¹/é‡å†™ç« èŠ‚ |
| `FINAL_APPROVAL` | æŠ¥å‘Šå®Œæˆå‰ | æœ€ç»ˆç¡®è®¤å’Œå‘å¸ƒæ‰¹å‡† | æœ€ç»ˆç¡®è®¤/å†æ¬¡ä¿®æ”¹/ç”Ÿæˆæ–°ç‰ˆæœ¬ |

### 3. è¿è¡Œæ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | è¯´æ˜ | äº¤äº’æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|----------|
| **COPILOT** | è‡ªåŠ¨åŒ–æ¨¡å¼ | æ‰€æœ‰äº¤äº’ç‚¹è‡ªåŠ¨é€šè¿‡ | æ‰¹é‡å¤„ç†ã€å¿«é€Ÿç”Ÿæˆ |
| **INTERACTIVE** | å®Œå…¨äº¤äº’æ¨¡å¼ | æ¯ä¸ªäº¤äº’ç‚¹éƒ½éœ€è¦ç”¨æˆ·ç¡®è®¤ | é«˜è´¨é‡å®šåˆ¶ã€ç²¾ç¡®æ§åˆ¶ |
| **GUIDED** | å¼•å¯¼æ¨¡å¼ | ç³»ç»Ÿæä¾›å»ºè®®ï¼Œç”¨æˆ·å†³ç­– | å¹³è¡¡è‡ªåŠ¨åŒ–å’Œæ§åˆ¶æ€§ |

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. äº¤äº’èŠ‚ç‚¹å·¥å‚

```python
def create_interaction_node(interaction_type: InteractionType):
    def interaction_node(state: DeepResearchState) -> DeepResearchState:
        # 1. æ£€æŸ¥è¿è¡Œæ¨¡å¼
        # 2. COPILOTæ¨¡å¼è‡ªåŠ¨é€šè¿‡
        # 3. å…¶ä»–æ¨¡å¼ä½¿ç”¨interrupt()ç­‰å¾…ç”¨æˆ·è¾“å…¥
        # 4. å¤„ç†ç”¨æˆ·å“åº”å¹¶æ›´æ–°çŠ¶æ€
        # 5. è®°å½•äº¤äº’å†å²
    return interaction_node
```

### 2. ä¸­æ–­æœºåˆ¶

```python
# ä½¿ç”¨LangGraphçš„interruptåŠŸèƒ½æš‚åœå·¥ä½œæµ
user_response = interrupt({
    "type": interaction_type.value,
    "title": "äº¤äº’æ ‡é¢˜",
    "message": "è¯¦ç»†æç¤ºä¿¡æ¯", 
    "options": ["é€‰é¡¹1", "é€‰é¡¹2", "é€‰é¡¹3"],
    "default": "é»˜è®¤é€‰é¡¹"
})
```

### 3. çŠ¶æ€ç®¡ç†

```python
# è®°å½•ç”¨æˆ·åé¦ˆ
state["user_feedback"][interaction_type.value] = user_response

# è®°å½•å®¡æ‰¹çŠ¶æ€  
state["approval_status"][interaction_type.value] = approved

# æ·»åŠ äº¤äº’å†å²
add_user_interaction(state, interaction_type.value, user_response)
```

## ğŸ“Š æµå¼è¾“å‡ºé›†æˆ

äº¤äº’åŠŸèƒ½ä¸æµå¼è¾“å‡ºå®Œå…¨é›†æˆï¼š

```python
writer({
    "step": f"interaction_{interaction_type.value}",
    "status": "ç­‰å¾…ç”¨æˆ·ç¡®è®¤", 
    "progress": 50,
    "awaiting_user_input": True,
    "interaction_type": interaction_type.value,
    "message": formatted_message,
    "options": available_options
})
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### 1. è‡ªåŠ¨åŒ–æ¨¡å¼ï¼ˆCOPILOTï¼‰

```python
result = await run_deep_research_report(
    topic="AIåº”ç”¨ç ”ç©¶",
    mode=ReportMode.COPILOT,  # è‡ªåŠ¨é€šè¿‡æ‰€æœ‰äº¤äº’ç‚¹
    user_id="auto_user"
)
```

### 2. äº¤äº’æ¨¡å¼ï¼ˆINTERACTIVEï¼‰

```python
# éœ€è¦é…åˆcheckpointerå’Œinterrupt handler
result = await run_deep_research_report(
    topic="AIåº”ç”¨ç ”ç©¶", 
    mode=ReportMode.INTERACTIVE,  # æ¯ä¸ªäº¤äº’ç‚¹éƒ½éœ€è¦ç¡®è®¤
    user_id="interactive_user"
)

# åœ¨å·¥ä½œæµæ‰§è¡Œä¸­ä¼šè§¦å‘interruptï¼Œéœ€è¦å¤–éƒ¨å¤„ç†ï¼š
def handle_interrupt(interrupt_data):
    print(f"ç”¨æˆ·ç¡®è®¤: {interrupt_data['message']}")
    return {"approved": True, "choice": "ç¡®è®¤ç»§ç»­"}
```

### 3. æµå¼äº¤äº’æ¨¡å¼

```python
async for chunk in stream_deep_research_report(
    topic="AIåº”ç”¨ç ”ç©¶",
    mode=ReportMode.INTERACTIVE
):
    if chunk.get("type") == "stream_chunk":
        data = chunk.get("data", {})
        if isinstance(data, tuple):
            mode, content = data
            if content.get("awaiting_user_input"):
                # å¤„ç†ç”¨æˆ·äº¤äº’è¯·æ±‚
                interaction_type = content.get("interaction_type")
                message = content.get("message")  
                options = content.get("options")
                # æ˜¾ç¤ºç»™ç”¨æˆ·å¹¶è·å–å“åº”
```

## ğŸ› ï¸ é…ç½®ç®¡ç†

æ¯ç§äº¤äº’ç±»å‹éƒ½æœ‰ä¸“é—¨çš„é…ç½®ï¼š

```python
INTERACTION_CONFIGS = {
    InteractionType.OUTLINE_CONFIRMATION: {
        "title": "å¤§çº²ç¡®è®¤",
        "copilot_message": "è‡ªåŠ¨ç¡®è®¤æŠ¥å‘Šå¤§çº²ï¼Œç»§ç»­æ‰§è¡Œç ”ç©¶",
        "options": ["ç¡®è®¤ç»§ç»­", "ä¿®æ”¹å¤§çº²", "é‡æ–°ç”Ÿæˆ"],
        "default": "ç¡®è®¤ç»§ç»­"
    },
    # ... å…¶ä»–é…ç½®
}
```

## ğŸ“ æ¶ˆæ¯æ ¼å¼åŒ–

ä¸ºä¸åŒäº¤äº’ç±»å‹æä¾›å®šåˆ¶åŒ–çš„ç”¨æˆ·æç¤ºï¼š

```python
def format_interaction_message(state, interaction_type, config):
    if interaction_type == InteractionType.OUTLINE_CONFIRMATION:
        # å±•ç¤ºè¯¦ç»†çš„å¤§çº²ä¿¡æ¯ä¾›ç”¨æˆ·ç¡®è®¤
        return formatted_outline_message
    elif interaction_type == InteractionType.RESEARCH_PERMISSION:
        # è¯´æ˜ç ”ç©¶èŒƒå›´å’Œæ—¶é—´é¢„ä¼°
        return formatted_research_message  
    # ... å…¶ä»–æ ¼å¼åŒ–é€»è¾‘
```

## ğŸ”„ å·¥ä½œæµé›†æˆ

äº¤äº’èŠ‚ç‚¹å®Œå…¨é›†æˆåˆ°LangGraphå·¥ä½œæµä¸­ï¼š

```python
# å·¥ä½œæµå®šä¹‰
graph.add_node("outline_generation", outline_generation_node)
graph.add_node("outline_confirmation", outline_confirmation_node)  # äº¤äº’èŠ‚ç‚¹
graph.add_node("research_execution", multi_agent_research_node)
graph.add_node("research_permission", research_permission_node)    # äº¤äº’èŠ‚ç‚¹

# è·¯ç”±é€»è¾‘
graph.add_edge("outline_generation", "outline_confirmation") 
graph.add_edge("outline_confirmation", "research_execution")
```

## ğŸ® å‰ç«¯é›†æˆå»ºè®®

### 1. Webç•Œé¢äº¤äº’

```javascript
// ç›‘å¬æµå¼æ•°æ®ä¸­çš„äº¤äº’è¯·æ±‚
if (chunk.awaiting_user_input) {
    showInteractionDialog({
        title: chunk.interaction_type,
        message: chunk.message,
        options: chunk.options,
        onConfirm: (response) => {
            // æ¢å¤å·¥ä½œæµæ‰§è¡Œ
            continueWorkflow(response);
        }
    });
}
```

### 2. çŠ¶æ€æŒä¹…åŒ–

```python
# ä½¿ç”¨checkpointeræ”¯æŒå·¥ä½œæµä¸­æ–­å’Œæ¢å¤
checkpointer = InMemorySaver()
config = {"configurable": {"thread_id": "user_session_001"}}

# ä¸­æ–­åå¯ä»¥ä»æ–­ç‚¹æ¢å¤
result = await graph.ainvoke(initial_state, config=config)
```

## ğŸš€ æ‰©å±•åŠŸèƒ½

### 1. è‡ªå®šä¹‰äº¤äº’ç±»å‹

```python
class CustomInteractionType(str, Enum):
    CUSTOM_REVIEW = "custom_review"

# æ·»åŠ è‡ªå®šä¹‰é…ç½®
INTERACTION_CONFIGS[CustomInteractionType.CUSTOM_REVIEW] = {
    "title": "è‡ªå®šä¹‰å®¡æŸ¥",
    "options": ["é€šè¿‡", "ä¿®æ”¹", "æ‹’ç»"],
    "default": "é€šè¿‡"
}
```

### 2. æ¡ä»¶äº¤äº’

```python
def conditional_interaction_node(state):
    """æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦éœ€è¦äº¤äº’"""
    if should_require_interaction(state):
        return interaction_node(state)
    else:
        return auto_approve_node(state)
```

## ğŸ“ˆ ç›‘æ§å’Œåˆ†æ

ç³»ç»Ÿè‡ªåŠ¨è®°å½•äº¤äº’ç»Ÿè®¡ï¼š

```python
# æ€§èƒ½æŒ‡æ ‡ä¸­åŒ…å«äº¤äº’æ•°æ®
performance_metrics = {
    "interaction_count": 5,           # äº¤äº’æ¬¡æ•°
    "avg_response_time": 15.2,        # å¹³å‡å“åº”æ—¶é—´  
    "approval_rate": 0.8,             # æ‰¹å‡†ç‡
    "interaction_types": [            # äº¤äº’ç±»å‹åˆ†å¸ƒ
        "outline_confirmation", 
        "research_permission",
        "analysis_approval"
    ]
}
```

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

1. **ğŸ”„ çµæ´»æ€§**: æ”¯æŒå®Œå…¨è‡ªåŠ¨åŒ–åˆ°å®Œå…¨æ‰‹åŠ¨çš„å„ç§æ¨¡å¼
2. **ğŸ“Š å¯è§†åŒ–**: å®Œæ•´çš„æµå¼è¾“å‡ºå’Œè¿›åº¦è·Ÿè¸ª  
3. **ğŸ’¾ æŒä¹…åŒ–**: æ”¯æŒå·¥ä½œæµä¸­æ–­å’Œæ¢å¤
4. **ğŸ¯ ç²¾ç¡®æ§åˆ¶**: åœ¨å…³é”®å†³ç­–ç‚¹æä¾›ç”¨æˆ·æ§åˆ¶
5. **ğŸ“ˆ å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„äº¤äº’ç±»å‹å’Œé…ç½®
6. **ğŸ”§ é›†æˆæ€§**: ä¸æ•´ä¸ªæŠ¥å‘Šç”Ÿæˆç³»ç»Ÿæ— ç¼é›†æˆ

è¿™å¥—äº¤äº’æ‰“æ–­åŠŸèƒ½ç³»ç»Ÿä¸ºç”¨æˆ·æä¾›äº†åœ¨è‡ªåŠ¨åŒ–å’Œäººå·¥æ§åˆ¶ä¹‹é—´çš„å®Œç¾å¹³è¡¡ï¼Œç¡®ä¿æ—¢èƒ½äº«å—AIçš„æ•ˆç‡ï¼Œåˆèƒ½ä¿æŒå¯¹ç»“æœè´¨é‡çš„ç²¾ç¡®æ§åˆ¶ã€‚